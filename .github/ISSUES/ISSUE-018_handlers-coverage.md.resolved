# üß™ TEST-COV: Cobertura de Handlers de UI (Clear/Refresh)

**Status:** ‚úÖ Conclu√≠do (v2.9.6)
**Prioridade:** Imediata (Critical/User Flow)
**Componentes:** `ClearHandler.js`, `RefreshHandler.js`
**Tipo:** Testes / UI Logic
**Resolvido em:** 31/12/2025

---

## üîó Relacionado

**ISSUE Pai:** [ISSUES_v2.9.6](./ISSUES-[013-016]-OPEN-v2.9.6.md)

Identificado na auditoria de 31/12 que os handlers de intera√ß√£o da UI possuem **0% de cobertura de fun√ß√µes**. Eles controlam a limpeza de cache e atualiza√ß√£o manual, fluxos cr√≠ticos para o usu√°rio.

---

## üìã Problema Atual

### **Cobertura de Fun√ß√µes: 0%**
- `ClearHandler.js`: Respons√°vel por limpar o storage e resetar a view.
- `RefreshHandler.js`: Dispara o refresh manual via UI.

Ambos cont√™m l√≥gica de estado (loading, success, error) e intera√ß√£o com o DOM/Services que est√° totalmente descoberta. Se um handler falhar, o bot√£o clica e "nada acontece" ou a UI trava.

## üìê Padr√µes Arquiteturais Obrigat√≥rios
- **[ADR 000-C: Padr√£o AAA](../../docs/architecture/ADR_000_C_AAA_TESTING_PATTERN.md)**: handlers devem testar `click` (Act) e verificar mudan√ßas de DOM (Assert).

---

## ‚úÖ Solu√ß√£o Proposta

### **Testes Unit√°rios com Mocks de DOM:**
Como s√£o handlers de UI acoplados a elementos HTML, devemos testar:
1.  **Binding:** O evento de click dispara a fun√ß√£o?
2.  **Estado:** O bot√£o entra em estado `loading`? Retorna ao normal ap√≥s sucesso?
3.  **Delega√ß√£o:** Chama o `RefresherService` ou `StorageService` corretamente?
4.  **Feedback:** Exibe o `Toaster` de sucesso/erro?

---

## üõ†Ô∏è Implementa√ß√£o Proposta

### **Exemplo para `RefreshHandler.test.js`:**

```javascript
import { RefreshHandler } from '../RefreshHandler';

test('clique deve disparar refresh e atualizar UI', async () => {
    // Arrange
    const btn = document.createElement('button');
    const refresherMock = { refresh: jest.fn().mockResolvedValue() };
    const handler = new RefreshHandler(btn, refresherMock);

    // Act
    btn.click();

    // Assert
    expect(btn.classList).toContain('loading'); // Verifica estado visual
    expect(refresherMock.refresh).toHaveBeenCalled(); // Verifica delega√ß√£o
    
    await waitForPromises();
    expect(btn.classList).not.toContain('loading'); // Verifica cleanup
});
```

---

## üß™ Plano de Testes

### **Cen√°rios a Cobrir:**
1.  **Sucesso no Refresh:** UI bloqueia -> Servi√ßo roda -> UI libera -> Toast Sucesso.
2.  **Erro no Refresh:** UI bloqueia -> Servi√ßo falha -> UI libera -> Toast Erro.
3.  **Clear Cache:** Confirma√ß√£o (se houver) -> Limpeza Storage -> Reload da Lista.

---

## ‚úÖ Crit√©rios de Sucesso

- [ ] Arquivos de teste criados para ambos os handlers.
- [ ] 100% de cobertura de fun√ß√µes (handlers s√£o pequenos).
- [ ] Valida√ß√£o de transi√ß√µes de estado visual (loading spinners).

---

**Tags:** `//ISSUE-ui-handlers-coverage` | **Tipo:** Testing | **Vers√£o:** 2.9.6
**Criado:** 2025-12-31 | **Autor:** Prof. Antigravity
